"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Page=exports.History=exports.Events=exports.Container=void 0,require("./page"),require("page.js"),require("./container"),require("./events"),require("./history");var Container=function(){function e(t){_classCallCheck(this,e),this.id=t,this.rootElement=document.getElementById(t)||document.body,this.currentPage=this.parsePage(href,document.title,document.body.className)}return _createClass(e,[{key:"render",value:function(e){for(currentPage.update(),document.title=e.documentTitle,document.body.className=e.bodyClass;e.rootElement.firstChild;)this.rootElement.appendChild(e.rootElement.firstChild);window.scrollTo(e.scrollX,e.scrollY),this.currentPage=e}},{key:"parsePage",value:function(e,t){var n=(new DOMParser).parseFromString(t,"text/html"),a=n.title,r=n.body.className,i=null;return i=id?n.getElementByID(container.id):n.body,new Page(e,a,r,i)}}]),e}();exports.Container=Container;var Events=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"on",value:function(e,t,n,a){var r=a.querySelectorAll(e);a=a||document,r.forEach(function(e){e.addEventListener(t,n)})}},{key:"live",value:function(e,t,n){var a=this;(this.on(e,t,n),window.MutationObserver)&&new MutationObserver(function(r){r.forEach(function(r){"childList"===r.type&&r.addedNodes.forEach(function(r){r.matches&&r.matches(e)?r.addEventListener(t,n):r.querySelectorAll&&a.on(e,t,n,r)})})}).observe(document.body,{childList:!0,subtree:!0})}}]),e}();exports.Events=Events;var History=function(){function e(t){_classCallCheck(this,e),this.cacheTimeout=t,this.pages={}}return _createClass(e,[{key:"getPage",value:function(e){var t=this.pages[e],n=null;return void 0!==t&&(!this.cacheTimeout||(new Date).now-t.timestamp<=this.cacheTimeout)&&(n=t),n}},{key:"setPage",value:function(e){this.getPage(e.key)&&(e.timestamp=(new Date).now),this.pages[e.key]=e}}]),e}();exports.History=History,function(){function e(e){var t=!0;return"_blank"!==(e.getAttribute("target")||"").toLowerCase()&&(t=function(e){var t=!0;if(window.location.hostname===e.hostname){var a=e.pathname;if(window.location.pathname!==a||!e.hash){var r=n.urlBlacklist;for(var i in r){var o=r[i];if(o.test(a)){t=!0;break}}}}return t}(e)),t}function t(){var t=this,a=new Container(containerId),r=new History(n.cacheTimeout),i=a.currentPage;r.appendPage(i),window.history.replaceState({key:i.key},i.documentTitle,document.location.href),Events.live("a","click",function(n){var i=t;if(!e(i)){n.preventDefault();var o=document.body.classList;if(!o.contains("ajax-navigation-fetching")){o.add("ajax-navigation-fetching");var s=i.href,c=Page.generateKey(s),l=r.getPage(c);l?a.render(l):fetch(s).then(function(e){var t=Container.parsePage(s,e);o.remove("ajax-navigation-fetching"),r.setPage(t),a.render(t),window.history.pushState({key:t.key},t.documentTitle,s)}).catch(function(){window.location.href=s})}}}),window.addEventListener("popstate",function(e){var t=e.state?e.state.key:null;t&&a.render(r.getPage(t))})}if(void 0!==window.ajaxNavigation){var n=window.ajaxNavigation,a=document.readyState;"complete"===a||"interactive"===a?t():document.addEventListener("DOMContentLoaded",t)}}();var Page=function(){function e(t,n,a,r){_classCallCheck(this,e),this.key=this.generateKey(t),this.documentTitle=n,this.bodyClass=a,this.rootElement=r,this.timestamp=(new Date).now,this.updateScroll()}return _createClass(e,[{key:"update",value:function(){this.documentTitle=document.title,this.updateScroll()}},{key:"updateScroll",value:function(){this.scrollX=window.scrollX,this.scrollY=window.scrollY}}],[{key:"generateKey",value:function(e){var t=e.replace(document.location.origin,""),n=!1;return t.length?"/"!==t.charAt(t.length-1)&&(n=!0):n=!0,n&&(t+="/"),t}},{key:"parseHTML",value:function(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=(new DOMParser).parseFromString(n,"text/html");return new e(t,r.title,r.body.className,a?r.getElementByID(a):r.body)}}]),e}();exports.Page=Page;