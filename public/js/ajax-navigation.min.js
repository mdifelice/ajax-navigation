"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Page=exports.History=exports.Events=exports.Container=void 0,require("./page"),require("page.js"),require("./container"),require("./events"),require("./history");var Container=function(){function a(b){_classCallCheck(this,a),this.id=b,this.rootElement=document.getElementById(b)||document.body,this.currentPage=this.parsePage(href,document.title,document.body.className)}return _createClass(a,[{key:"render",value:function(a){for(currentPage.update(),document.title=a.documentTitle,document.body.className=a.bodyClass;a.rootElement.firstChild;)this.rootElement.appendChild(a.rootElement.firstChild);window.scrollTo(a.scrollX,a.scrollY),this.currentPage=a}},{key:"parsePage",value:function(a,b){var c=new DOMParser,d=c.parseFromString(b,"text/html"),e=d.title,f=d.body.className,g=null;return g=id?d.getElementByID(container.id):d.body,new Page(a,e,f,g)}}]),a}();exports.Container=Container;var Events=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"on",value:function(a,b,c,d){var e=d.querySelectorAll(a);d=d||document,e.forEach(function(a){a.addEventListener(b,c)})}},{key:"live",value:function(a,b,c){var d=this;if(this.on(a,b,c),window.MutationObserver){new MutationObserver(function(e){e.forEach(function(e){"childList"===e.type&&e.addedNodes.forEach(function(e){e.matches&&e.matches(a)?e.addEventListener(b,c):e.querySelectorAll&&d.on(a,b,c,e)})})}).observe(document.body,{childList:!0,subtree:!0})}}}]),a}();exports.Events=Events;var History=function(){function a(b){_classCallCheck(this,a),this.cacheTimeout=b,this.pages={}}return _createClass(a,[{key:"getPage",value:function(a){var b=this.pages[a],c=null;return void 0!==b&&(!this.cacheTimeout||(new Date).now-b.timestamp<=this.cacheTimeout)&&(c=b),c}},{key:"setPage",value:function(a){this.getPage(a.key)&&(a.timestamp=(new Date).now),this.pages[a.key]=a}}]),a}();exports.History=History,function(){function a(a){var c=a.getAttribute("target")||"",d=!0;return"_blank"!==c.toLowerCase()&&(d=b(a)),d}function b(a){var b=!0;if(window.location.hostname===a.hostname){var c=a.pathname;if(window.location.pathname!==c||!a.hash){var e=d.urlBlacklist;for(var f in e){if(e[f].test(c)){b=!0;break}}}}return b}function c(){var b=this,c=new Container(containerId),e=new History(d.cacheTimeout),f=c.currentPage;e.appendPage(f),window.history.replaceState({key:f.key},f.documentTitle,document.location.href),Events.live("a","click",function(d){var f=b;if(!a(f)){d.preventDefault();var g=document.body.classList;if(!g.contains("ajax-navigation-fetching")){g.add("ajax-navigation-fetching");var h=f.href,i=Page.generateKey(h),j=e.getPage(i);j?c.render(j):fetch(h).then(function(a){var b=Container.parsePage(h,a);g.remove("ajax-navigation-fetching"),e.setPage(b),c.render(b),window.history.pushState({key:b.key},b.documentTitle,h)}).catch(function(){window.location.href=h})}}}),window.addEventListener("popstate",function(a){var b=a.state?a.state.key:null;b&&c.render(e.getPage(b))})}if(void 0!==window.ajaxNavigation){var d=window.ajaxNavigation,e=document.readyState;"complete"===e||"interactive"===e?c():document.addEventListener("DOMContentLoaded",c)}}();var Page=function(){function a(b,c,d,e){_classCallCheck(this,a),this.key=this.generateKey(b),this.documentTitle=c,this.bodyClass=d,this.rootElement=e,this.timestamp=(new Date).now,this.updateScroll()}return _createClass(a,[{key:"update",value:function(){this.documentTitle=document.title,this.updateScroll()}},{key:"updateScroll",value:function(){this.scrollX=window.scrollX,this.scrollY=window.scrollY}}],[{key:"generateKey",value:function(a){var b=a.replace(document.location.origin,""),c=!1;return b.length?"/"!==b.charAt(b.length-1)&&(c=!0):c=!0,c&&(b+="/"),b}},{key:"parseHTML",value:function(b,c){var d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,e=new DOMParser,f=e.parseFromString(c,"text/html"),g=f.title,h=f.body.className,i=null;return i=d?f.getElementByID(d):f.body,new a(b,g,h,i)}}]),a}();exports.Page=Page;